<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Указать e-mail</title>
  <style>
    body{margin:0;background:#f6f7fb;font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Inter}
    .wrap{max-width:640px;margin:24px auto;padding:0 14px}
    .card{background:#fff;border-radius:14px;box-shadow:0 2px 14px rgba(15,23,42,.06);padding:16px}
    .row{display:flex;gap:10px}
    input{flex:1;padding:12px 14px;border:1px solid #e2e8f0;border-radius:12px;font:inherit}
    .btn{background:#f97316;color:#fff;border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h2 style="margin:0 0 12px">Укажите e-mail для отправки PDF</h2>
      <div class="row">
        <input id="email" type="email" placeholder="name@example.com" autocomplete="email">
        <button id="save" class="btn">Сохранить</button>
      </div>
      <div style="margin-top:10px;color:#64748b;font-size:12px">Мы сохраним e-mail в Telegram CloudStorage, он будет подставляться автоматически.</div>
    </div>
  </div>

  <script>
    const tg = window.Telegram?.WebApp; try{ tg?.ready(); tg?.expand(); }catch(e){}
    (async()=>{
      try{
        const res = await tg?.CloudStorage?.getItem('email');
        if (res) document.getElementById('email').value = res;
      }catch(e){}
    })();

    document.getElementById('save').addEventListener('click', async ()=>{
      const v = (document.getElementById('email').value||'').trim();
      if (!v || !/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(v)) {
        return tg?.showAlert?.('Введите корректный e-mail');
      }
      try{
        await tg?.CloudStorage?.setItem('email', v);
        // также в localStorage на всякий случай
        try { localStorage.setItem('email', v) } catch(e){}
        tg?.showPopup?.({title:'Готово', message:'E-mail сохранён', buttons:[{type:'ok'}]});
        location.href = './index.html';
      }catch(e){
        tg?.showAlert?.('Не удалось сохранить: '+e.message);
      }
    });
  </script>
</body>
</html>
